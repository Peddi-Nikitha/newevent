"use strict";(()=>{var e={};e.id=873,e.ids=[873],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},40645:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>v,patchFetch:()=>h,requestAsyncStorage:()=>d,routeModule:()=>u,serverHooks:()=>c,staticGenerationAsyncStorage:()=>g});var r={};n.r(r),n.d(r,{GET:()=>p});var a=n(49303),o=n(88716),s=n(60670),i=n(87070);let l=new(n(53524)).PrismaClient;async function p(e){try{let{searchParams:t}=new URL(e.url),n=parseInt(t.get("page")||"1"),r=parseInt(t.get("limit")||"10"),a=(n-1)*r,o=t.get("type")||void 0,s=t.get("location")||void 0,p=t.get("budget")||void 0,u=`
      SELECT e.id, e.* 
      FROM "Event" e
      WHERE 1=1
    `,d=[];if(o&&(u+=` AND e."eventtype" = $${d.length+1}`,d.push(o)),s&&(u+=` AND e.location ILIKE $${d.length+1}`,d.push(`%${s}%`)),p){let[e,t]=p.split("-").map(Number);if(t)u+=` AND e.budget >= $${d.length+1} AND e.budget <= $${d.length+2}`,d.push(e,t);else if(p.endsWith("+")){let e=parseInt(p.replace("+",""));u+=` AND e.budget >= $${d.length+1}`,d.push(e)}}u+=` ORDER BY e.date DESC LIMIT $${d.length+1} OFFSET $${d.length+2}`,d.push(r,a),console.log("Executing query:",u,d);let g=await l.$queryRawUnsafe(u,...d),c=u.replace("SELECT e.id, e.*","SELECT COUNT(*)");c=c.substring(0,c.indexOf("ORDER BY"));let v=await l.$queryRawUnsafe(c,...d.slice(0,-2)),h=parseInt(v[0].count||"0");console.log(`Found ${g.length} events out of ${h} total`);let m=g.map(e=>{console.log("Event data from DB:",Object.keys(e));let t=e.eventtype||"Unknown";return{id:e.id,eventType:t,location:e.location||"Unknown",date:e.date?new Date(e.date).toISOString():new Date().toISOString(),budget:e.budget||0,imageUrl:e.imageUrl||null,vendors:[]}});return i.NextResponse.json({events:m,pagination:{total:h,page:n,limit:r,totalPages:Math.ceil(h/r),hasMore:n*r<h}})}catch(e){return console.error("Error fetching events:",e),i.NextResponse.json({error:"Failed to fetch events",details:e instanceof Error?e.message:String(e)},{status:500})}}let u=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/events/route",pathname:"/api/events",filename:"route",bundlePath:"app/api/events/route"},resolvedPagePath:"C:\\Users\\S\\Downloads\\eveplan\\eveplan\\app\\api\\events\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:d,staticGenerationAsyncStorage:g,serverHooks:c}=u,v="/api/events/route";function h(){return(0,s.patchFetch)({serverHooks:c,staticGenerationAsyncStorage:g})}}};var t=require("../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),r=t.X(0,[276,972],()=>n(40645));module.exports=r})();